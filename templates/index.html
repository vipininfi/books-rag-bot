<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookRAG Pro - AI-Powered Book Search Platform</title>
    <link rel="stylesheet" href="/static/css/style.css?v=6">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>
<body>
    <div class="app-container">
        
        <!-- Sidebar Navigation -->
        <div id="sidebar" class="sidebar hidden">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-book-open"></i>
                    <span>BookRAG Pro</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <h3>Search & Discovery</h3>
                    <a href="#" class="nav-item active" data-tab="search">
                        <i class="fas fa-search"></i>
                        <span>Search Books</span>
                    </a>
                    <a href="#" class="nav-item" data-tab="rag">
                        <i class="fas fa-robot"></i>
                        <span>Ask AI</span>
                    </a>
                    <a href="#" class="nav-item" data-tab="authors">
                        <i class="fas fa-users"></i>
                        <span>Browse Authors</span>
                    </a>
                </div>

                <div class="nav-section" id="authorSection">
                    <h3>Author Tools</h3>
                    <a href="#" class="nav-item" data-tab="upload">
                        <i class="fas fa-upload"></i>
                        <span>Upload Books</span>
                    </a>
                    <a href="#" class="nav-item" data-tab="my-books">
                        <i class="fas fa-book"></i>
                        <span>My Books</span>
                    </a>
                </div>

                <div class="nav-section">
                    <h3>Account</h3>
                    <a href="#" class="nav-item" data-tab="profile">
                        <i class="fas fa-user-circle"></i>
                        <span>Profile Settings</span>
                    </a>
                    <a href="#" class="nav-item" data-tab="subscriptions" id="navSubscriptions">
                        <i class="fas fa-heart"></i>
                        <span>My Subscriptions</span>
                    </a>
                    <a href="#" class="nav-item" data-tab="subscribed-books" id="navSubscribedBooks">
                        <i class="fas fa-book"></i>
                        <span>Books</span>
                    </a>
                    <a href="#" class="nav-item" data-tab="analytics" id="navAnalytics">
                        <i class="fas fa-chart-line"></i>
                        <span>Usage Analytics</span>
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                        <div class="user-name" id="sidebarUserName">Loading...</div>
                        <div class="user-role" id="sidebarUserRole">Loading...</div>
                    </div>
                </div>
                <button class="logout-btn" id="sidebarLogoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </div>

        <!-- Authentication Section -->
        <div id="authSection" class="auth-container">
            <div class="auth-card">
                <div class="auth-header">
                    <div class="auth-logo">
                        <i class="fas fa-book-open"></i>
                        <h1>BookRAG Pro</h1>
                        <p>AI-Powered Book Search Platform</p>
                    </div>
                </div>

                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="showAuthTab('login')">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                    <button class="auth-tab" onclick="showAuthTab('register')">
                        <i class="fas fa-user-plus"></i> Register
                    </button>
                </div>

                <!-- Login Form -->
                <div id="loginAuthTab" class="auth-form">
                    <h2>Welcome Back</h2>
                    <p>Sign in to your account to continue</p>
                    <form id="loginForm" onsubmit="return false;">
                        <div class="form-group">
                            <label for="loginEmail">
                                <i class="fas fa-envelope"></i> Email Address
                            </label>
                            <input type="email" id="loginEmail" name="email" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">
                                <i class="fas fa-lock"></i> Password
                            </label>
                            <input type="password" id="loginPassword" name="password" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-full">
                            <i class="fas fa-sign-in-alt"></i> Sign In
                        </button>
                    </form>
                </div>

                <!-- Register Form -->
                <div id="registerAuthTab" class="auth-form hidden">
                    <h2>Create Account</h2>
                    <p>Join our community of readers and authors</p>
                    <form id="registerForm" onsubmit="return false;">
                        <div class="form-group">
                            <label for="registerEmail">
                                <i class="fas fa-envelope"></i> Email Address
                            </label>
                            <input type="email" id="registerEmail" name="email" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="registerUsername">
                                <i class="fas fa-user"></i> Username
                            </label>
                            <input type="text" id="registerUsername" name="username" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="registerPassword">
                                <i class="fas fa-lock"></i> Password
                            </label>
                            <input type="password" id="registerPassword" name="password" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="registerRole">
                                <i class="fas fa-user-tag"></i> Account Type
                            </label>
                            <select id="registerRole" name="role" class="form-control" required>
                                <option value="user">üìö Reader - Search & explore books</option>
                                <option value="author">‚úçÔ∏è Author - Upload & manage books</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary btn-full">
                            <i class="fas fa-user-plus"></i> Create Account
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Top Header -->
            <div class="top-header">
                <div class="header-title">
                    <h1 id="pageTitle">Search Books</h1>
                    <p id="pageSubtitle">Find information across your subscribed authors' books</p>
                </div>
                <div class="header-actions">
                    <button class="header-btn" id="notificationsBtn">
                        <i class="fas fa-bell"></i>
                    </button>
                    <div class="user-menu">
                        <button class="user-menu-btn" id="userMenuBtn">
                            <div class="user-avatar-small">
                                <i class="fas fa-user"></i>
                            </div>
                            <span id="headerUserName">User</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="user-dropdown" id="userDropdown">
                            <a href="#" data-tab="profile">
                                <i class="fas fa-user-circle"></i> Profile Settings
                            </a>
                            <a href="#" data-tab="analytics" id="dropdownAnalytics">
                                <i class="fas fa-chart-line"></i> Usage Analytics
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" id="headerLogoutBtn">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Search Tab -->
                <div id="searchTab" class="tab-content">
                    <div class="content-card">
                        <div class="card-header">
                            <h2><i class="fas fa-search"></i> Search Your Library</h2>
                            <p>Search through content from authors you've subscribed to using semantic search.</p>
                        </div>
                        
                        <form id="searchForm" class="search-form">
                            <div class="search-container">
                                <input type="text" name="query" class="search-input" placeholder="Search for concepts, topics, or specific information..." required>
                                <button type="submit" class="search-btn">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </form>

                        <div id="searchResults" class="results-container"></div>
                    </div>
                </div>

                <!-- RAG Tab -->
                <div id="ragTab" class="tab-content hidden">
                    <div class="content-card">
                        <div class="card-header">
                            <h2><i class="fas fa-robot"></i> AI Assistant</h2>
                            <p>Ask questions and get AI-generated answers based on your subscribed authors' books.</p>
                        </div>
                        
                        <form id="ragForm" class="rag-form">
                            <div class="form-group">
                                <label for="ragQuery">Your Question</label>
                                <div class="voice-input-container">
                                    <textarea name="ragQuery" id="ragQuery" class="form-control" rows="3" 
                                            placeholder="Ask a question about the content in your subscribed books..." required></textarea>
                                    <div class="voice-controls">
                                        <button type="button" id="voiceInputBtn" class="btn btn-voice" title="Click to speak your question (auto-submits after 3 seconds of silence). Allow microphone access when prompted.">
                                            <i class="fas fa-microphone"></i>
                                        </button>
                                        <div id="voiceStatus" class="voice-status hidden">
                                            <i class="fas fa-circle recording-indicator"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-robot"></i> Get AI Answer
                                </button>
                                <div class="speech-controls hidden" id="speechControls">
                                    <button type="button" id="stopSpeechBtn" class="btn btn-warning">
                                        <i class="fas fa-volume-mute"></i> Stop Speaking
                                    </button>
                                    <div class="speech-status">
                                        <i class="fas fa-volume-up speaking-indicator"></i>
                                        <span>Speaking answer...</span>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <div id="ragResults" class="results-container"></div>
                    </div>
                </div>

                <!-- Authors Tab -->
                <div id="authorsTab" class="tab-content hidden">
                    <div class="content-card">
                        <div class="card-header">
                            <h2><i class="fas fa-users"></i> Discover Authors</h2>
                            <p>Browse and subscribe to authors to access their book content.</p>
                        </div>
                        
                        <div id="authorsGrid" class="authors-grid">
                            <!-- Authors will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Upload Tab -->
                <div id="uploadTab" class="tab-content hidden">
                    <div class="content-card">
                        <div class="card-header">
                            <h2><i class="fas fa-upload"></i> Upload Your Book</h2>
                            <p>Upload PDF books to make them searchable and available to your subscribers.</p>
                        </div>
                        
                        <form id="bookUploadForm" class="upload-form">
                            <div class="form-group">
                                <label for="bookTitle">Book Title</label>
                                <input type="text" id="bookTitle" name="title" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label for="bookDescription">Book Description (Optional)</label>
                                <textarea id="bookDescription" name="description" class="form-control" rows="3" 
                                        placeholder="Brief description of the book content..."></textarea>
                            </div>

                            <div class="form-group">
                                <label>PDF File</label>
                                <div id="fileUploadArea" class="file-input">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Drag & drop your PDF here or click to browse</p>
                                    <p class="file-hint">Maximum file size: 100MB</p>
                                </div>
                                <input type="file" id="fileInput" name="file" accept=".pdf" style="display: none;" required>
                            </div>

                            <button type="submit" class="btn btn-primary btn-full">
                                <i class="fas fa-upload"></i> Upload & Process Book
                            </button>
                        </form>

                        <div class="upload-info">
                            <h4><i class="fas fa-info-circle"></i> Processing Information</h4>
                            <ul>
                                <li>Books are automatically linked to your author profile</li>
                                <li>Books are processed using hybrid chunking (structural + semantic)</li>
                                <li>Embeddings are generated using BGE-Base model (free)</li>
                                <li>Processing time depends on book size (typically 2-10 minutes)</li>
                                <li>You'll be notified when processing is complete</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Profile Tab -->
                <div id="profileTab" class="tab-content hidden">
                    <div class="content-card">
                        <div class="card-header">
                            <h2><i class="fas fa-user-circle"></i> Profile Settings</h2>
                            <p>Manage your account information and preferences.</p>
                        </div>
                        
                        <form id="profileForm" class="profile-form">
                            <div class="profile-section">
                                <h3>Personal Information</h3>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="profileUsername">Username</label>
                                        <input type="text" id="profileUsername" name="username" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="profileEmail">Email Address</label>
                                        <input type="email" id="profileEmail" name="email" class="form-control" required>
                                    </div>
                                </div>
                                <div class="form-group" id="authorBioGroup">
                                    <label for="profileBio">Author Bio</label>
                                    <textarea id="profileBio" name="bio" class="form-control" rows="4" 
                                            placeholder="Tell readers about yourself and your work..."></textarea>
                                </div>
                            </div>

                            <div class="profile-section">
                                <h3>Account Security</h3>
                                <div class="form-group">
                                    <label for="currentPassword">Current Password</label>
                                    <input type="password" id="currentPassword" name="currentPassword" class="form-control">
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="newPassword">New Password</label>
                                        <input type="password" id="newPassword" name="newPassword" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label for="confirmPassword">Confirm New Password</label>
                                        <input type="password" id="confirmPassword" name="confirmPassword" class="form-control">
                                    </div>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                                <button type="button" class="btn btn-secondary" id="cancelProfileBtn">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Subscribed Books Tab (for readers) -->
                <div id="subscribed-booksTab" class="tab-content hidden">
                    <div class="content-card">
                        <div class="card-header">
                            <h2><i class="fas fa-book"></i> Subscribed Books</h2>
                            <p>Books from authors you are subscribed to.</p>
                        </div>
                        
                        <div id="subscribedBooksList" class="books-list">
                            <!-- Books will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Subscriptions Tab -->
                <div id="subscriptionsTab" class="tab-content hidden">
                    <div class="content-card">
                        <div class="card-header">
                            <h2><i class="fas fa-heart"></i> My Subscriptions</h2>
                            <p>Manage your author subscriptions and access to their content.</p>
                        </div>
                        
                        <div id="subscriptionsList" class="subscriptions-list">
                            <!-- Subscriptions will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div id="analyticsTab" class="tab-content hidden">
                    <div class="content-card">
                        <div class="card-header">
                            <h2><i class="fas fa-chart-line"></i> Usage Analytics</h2>
                            <p>Track your platform usage and token consumption.</p>
                        </div>
                        
                        <div class="analytics-summary">
                            <div class="analytics-card">
                                <div class="analytics-icon"><i class="fas fa-search"></i></div>
                                <div class="analytics-content">
                                    <h3 id="totalSearches">0</h3>
                                    <p>Total Searches</p>
                                </div>
                            </div>
                            <div class="analytics-card">
                                <div class="analytics-icon"><i class="fas fa-robot"></i></div>
                                <div class="analytics-content">
                                    <h3 id="totalQuestions">0</h3>
                                    <p>AI Questions</p>
                                </div>
                            </div>
                            <div class="analytics-card">
                                <div class="analytics-icon"><i class="fas fa-coins"></i></div>
                                <div class="analytics-content">
                                    <h3 id="totalTokens">0</h3>
                                    <p>Tokens Used</p>
                                </div>
                            </div>
                            <div class="analytics-card">
                                <div class="analytics-icon"><i class="fas fa-dollar-sign"></i></div>
                                <div class="analytics-content">
                                    <h3 id="totalCost">$0.0000</h3>
                                    <p>Total Cost</p>
                                </div>
                            </div>
                        </div>

                        <div class="analytics-breakdown">
                            <div class="breakdown-section">
                                <h3><i class="fas fa-book-open"></i> Book Processing</h3>
                                <div class="breakdown-stats">
                                    <div class="stat-item">
                                        <span>Tokens</span>
                                        <span id="bookTokens">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span>Cost</span>
                                        <span id="bookCost">$0.0000</span>
                                    </div>
                                </div>
                            </div>

                            <div class="breakdown-section">
                                <h3><i class="fas fa-comments"></i> AI Conversations</h3>
                                <div class="breakdown-stats">
                                    <div class="stat-group">
                                        <h4>Embedding</h4>
                                        <div class="stat-item">
                                            <span>Tokens</span>
                                            <span id="aiEmbedTokens">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <span>Cost</span>
                                            <span id="aiEmbedCost">$0.0000</span>
                                        </div>
                                    </div>
                                    <div class="stat-group">
                                        <h4>Prompt (Input)</h4>
                                        <div class="stat-item">
                                            <span>Tokens</span>
                                            <span id="aiPromptTokens">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <span>Cost</span>
                                            <span id="aiPromptCost">$0.0000</span>
                                        </div>
                                    </div>
                                    <div class="stat-group">
                                        <h4>Answer (Output)</h4>
                                        <div class="stat-item">
                                            <span>Tokens</span>
                                            <span id="aiAnswerTokens">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <span>Cost</span>
                                            <span id="aiAnswerCost">$0.0000</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="breakdown-section">
                                <h3><i class="fas fa-bolt"></i> Search Activity</h3>
                                <div class="breakdown-stats">
                                    <div class="stat-item">
                                        <span>Tokens</span>
                                        <span id="searchTokens">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span>Cost</span>
                                        <span id="searchCost">$0.0000</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="analytics-chart">
                            <h3>Usage Over Time</h3>
                            <div id="usageChart" class="chart-placeholder">
                                <i class="fas fa-chart-line"></i>
                                <p>Usage analytics will be displayed here</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- My Books Tab (Author only) -->
                <div id="my-booksTab" class="tab-content hidden">
                    <div class="content-card">
                        <div class="card-header">
                            <h2><i class="fas fa-book"></i> My Books</h2>
                            <p>Manage your uploaded books and track their processing status.</p>
                        </div>
                        
                        <div id="myBooksList" class="books-list">
                            <!-- Books will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden">
        <div>
            <div class="spinner"></div>
            <div class="loading-text">Loading...</div>
        </div>
    </div>

    <!-- Alert Container -->
    <div id="alertContainer"></div>

    <!-- PDF Viewer Modal -->
    <div id="pdfViewerModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="pdfViewerTitle">PDF Viewer</h3>
                <button class="modal-close" onclick="closePdfViewer()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="pdf-controls">
                    <button id="prevPage" onclick="prevPage()">
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <span id="pageInfo">Page 1 of 1</span>
                    <button id="nextPage" onclick="nextPage()">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                    <button id="zoomOut" onclick="zoomOut()">
                        <i class="fas fa-search-minus"></i>
                    </button>
                    <span id="zoomLevel">100%</span>
                    <button id="zoomIn" onclick="zoomIn()">
                        <i class="fas fa-search-plus"></i>
                    </button>
                </div>
                <div class="pdf-container">
                    <canvas id="pdfCanvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js?v=8"></script>
    <script>
        // Auth tab switching
        function showAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[onclick="showAuthTab('${tab}')"]`).classList.add('active');
            
            document.getElementById('loginAuthTab').classList.toggle('hidden', tab !== 'login');
            document.getElementById('registerAuthTab').classList.toggle('hidden', tab !== 'register');
        }
    </script>
</body>
</html>